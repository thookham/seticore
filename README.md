# seticore

A high-performance implementation of core SETI algorithms, including **turboSETI's dedoppler algorithm** (creating `.dat` from `.h5` files) and **beamforming** (producing filterbanks from `.raw` and `.bfr5` files). `seticore` is designed for speed and flexibility, supporting multiple compute backends to run on diverse hardware.

## Features

- **Multi-Backend Support**:
  - **CUDA**: Optimized for NVIDIA GPUs.
  - **SYCL**: Support for Intel GPUs (Arc, Data Center Flex/Max) and other oneAPI-compatible devices.
  - **NPU**: (Experimental) Scaffolding for Neural Processing Units.
  - **TPU**: (Experimental) Scaffolding for Tensor Processing Units.
  - **CPU**: Optimized fallback using FFTW3 and vector-friendly loops.
- **High Performance**: Native C++ implementation with minimal overhead.
- **Backend-Agnostic**: Core algorithms (Dedoppler, Beamforming) are abstractly defined, allowing easy addition of new hardware support.

## Installation

### Dependencies

To build `seticore`, you need the following common dependencies:

```bash
sudo apt-get install cmake g++ libboost-all-dev libhdf5-dev pkg-config
python3 -m pip install meson ninja
```

**Backend-specific dependencies:**

- **CPU**: `libfftw3-dev` (Highly recommended for performance).
- **CUDA**: [NVIDIA CUDA Toolkit](https://developer.nvidia.com/cuda-toolkit) (Required for CUDA backend).
- **SYCL**: [Intel oneAPI Base Toolkit](https://www.intel.com/content/www/us/en/developer/tools/oneapi/base-toolkit.html) (Required for SYCL backend, specifically `dpcpp` and `oneMKL`).

### Building from Source

1. **Clone the repository**:

   ```bash
   git clone https://github.com/thookham/seticore.git
   cd seticore
   git submodule update --init --recursive
   ```

2. **Setup the build directory**:

   ```bash
   meson setup build
   ```

3. **Configure the build**:
   You can enable or disable backends using meson options. The build system attempts to auto-detect available tools, but explicit configuration is safer.

   - **For NVIDIA GPUs (CUDA)**:

     ```bash
     meson configure build -Dcuda=enabled
     ```

   - **For Intel GPUs (SYCL)**:

     ```bash
     meson configure build -Dsycl=enabled
     ```

   - **For CPU Only**:

     ```bash
     meson configure build -Dcuda=disabled -Dsycl=disabled
     ```

4. **Compile**:

   ```bash
   ninja -C build
   ```

## Usage

Run `seticore` with no arguments to see the help text and available options:

```bash
./build/seticore --help
```

### Analysis

To analyze the data generated by `seticore` (hits, stamps):

- See the [Python docs](python/README.md).
- A [Jupyter notebook](python/example.ipynb) is provided to demonstrate how to analyze outputs.

## Testing

Run the unit test suite (which includes downloading test data):

```bash
./unit_tests.sh
```

### Docker Testing

A [Dockerfile](Dockerfile) is provided for a consistent environment. If you have the NVIDIA Container Toolkit installed, you can run tests in Docker:

```bash
./test_docker.sh
```

## Troubleshooting

### HDF5 Plugin Errors (Bitshuffle)

If you encounter errors regarding missing HDF5 plugins (specifically bitshuffle), you may need to manually install them, as some package managers exclude them.

Workaround using Python:

1. `pip install hdf5plugin`
2. Locate the plugin files: `pip show hdf5plugin` (look for Location)
3. Copy the `.so` files from the python package's `plugins` directory to the HDF5 plugin directory expected by your system (often `/usr/local/hdf5/lib/plugin` or defined by `HDF5_PLUGIN_PATH`).

### Debugging

To build with debug symbols:

```bash
meson configure --buildtype=debug build
ninja -C build
```

Revert to release for performance:

```bash
meson configure --buildtype=release build
ninja -C build
```

## Advanced

### GPU Selection

To select a specific GPU when multiple are available, use the `CUDA_VISIBLE_DEVICES` environment variable. Note that CUDA IDs might differ from `nvidia-smi` IDs.

```bash
# Use the first GPU
CUDA_DEVICE_ORDER=PCI_BUS_ID CUDA_VISIBLE_DEVICES=0 ./build/seticore ...
```

### Profiling

To profile the application on Linux (CPU):

```bash
sudo apt-get install perf
perf record -g ./build/seticore <args>
perf script > perf.script
# Use FlameGraph tools to visualize perf.script
```
